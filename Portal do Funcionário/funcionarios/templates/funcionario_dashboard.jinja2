{% extends 'base.html' %}
{% block title %}Painel Do Funcion√°rio{% endblock %}
{% block content %}

<div class="container text-center mt-4">
    <h2 class="mb-3">Painel do Funcion√°rio</h2>
    <p>Bem-vindo, <strong>{{ current_user.nome }}</strong>!</p>

    <div class="row mt-4">
        <div class="col-md-3">
            <div class="metric-card primary">
                <h5>Horas Trabalhadas</h5>
                <h3>{{ horas_trabalhadas }}h</h3>
            </div>
        </div>
        <div class="col-md-3">
            <div class="metric-card success">
                <h5>Horas Extras</h5>
                <h3>{{ horas_extras }}h</h3>
            </div>
        </div>
        <div class="col-md-3">
            <div class="metric-card warn">
                <h5>Banco de Horas</h5>
                <h3>{{ banco_horas }}h</h3>
            </div>
        </div>
        <div class="col-md-3">
            <div class="metric-card info">
                <h5>Pr√≥ximo Pagamento</h5>
                <h3>R$ {{ "{:,.2f}".format(proximo_pagamento) }}</h3>
            </div>
        </div>
    </div>

    <div class="row mt-5">
        <div class="col-md-6">
            <h4>Horas Trabalhadas por</h4>
            <canvas id="graficoHoras"></canvas>
        </div>
        <div class="col-md-6">
            <h4>Horas Extras por Semana</h4>
            <canvas id="graficoExtras"></canvas>
        </div>
    </div>

    <div class="mt-5">
        <h4>Hist√≥rico de Marca√ß√µes</h4>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Data</th>
                    <th>Entrada</th>
                    <th>Sa√≠da Almo√ßo</th>
                    <th>Retorno</th>
                    <th>Sa√≠da</th>
                    <th>Horas Extras</th>
                </tr>
            </thead>
            <tbody>
                {% for registro in registros %}
                <tr>
                    <td>{{ registro.data.strftime("%d/%m/%Y") }}</td>
                    <td>{{ registro.hora_entrada or "-" }}</td>
                    <td>{{ registro.hora_saida_almoco or "-" }}</td>
                    <td>{{ registro.hora_retorno_almoco or "-" }}</td>
                    <td>{{ registro.hora_saida or "-" }}</td>
                    <td>{{ registro.horas_extras or "0" }}h</td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="6" class="text-center">Nenhum registro encontrado.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<div class="text-center mt-4">
    <a href="{{ url_for('funcionarios.registrar_ponto') }}" class="btn btn-success">‚ûï Registrar Ponto</a>
    {% if ponto %}
    <ul>
        {% for marcacao in current_user.pontos[-1].marcacoes %}
                <li>{{ marcacao.tipo }} - {{ marcacao.hora.strftime("%H:%M") }}</li>
        {% endfor %}
    {% endif %}
    </ul>
    <a href="{{ url_for('avisos.mural') }}" class="btn btn-info"> üëÅ Ver Avisos</a>
    <a href="{{ url_for('funcionarios.historico') }}" class="btn btn-primary">üë• Ver Hist√≥rico</a>
    <a href="{{ url_for('auth.logout') }}" class="btn btn-outline-danger">‚õî Sair</a>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    window.funcionarioData = {
        semanas: {{ semanas|tojson }},
        horas_semanais: {{ horas_semanais|tojson }},
        extras_semanais: {{ extras_semanais|tojson }}
    };
</script>
<script src="{{ url_for('static', filename='js/funcionario_dashboard.js') }}"></script>
{% endblock %}